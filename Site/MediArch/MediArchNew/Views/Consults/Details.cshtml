@model Data.Domain.Entities.Consult

@using MediArch.Services.Interfaces
@inject IApplicationUserService user_service

@using Data.Domain.Interfaces.ServiceInterfaces
@inject IConsultService file_service
@inject UserManager<ApplicationUser> UserManager
@{
    ViewData["Title"] = "Consult - Details";
}
<div class="General_remake">
    <br />
    <h2>@ViewData["Title"]</h2>
    <hr />
    <div>
            <p><b>Medic:</b> <a asp-action="Details" asp-controller="Account" asp-route-id="@Model.MedicId">@user_service.GetFullNameById(Model.MedicId.ToString()).ToString()</a></p>
            <p><b>Pacient:</b> <a asp-action="Details" asp-controller="Account" asp-route-id="@Model.PacientId">@user_service.GetFullNameById(Model.PacientId.ToString()).ToString()</a></p>
            <p><b>Consult's Date:</b> @Model.ConsultDate</p>
            @if (Model.ConsultResult != null)
            {
                <p><b>Result:</b> @Model.ConsultResult</p>
            }
            @if (Model.Medicines != null)
            {
                <p><b>Prescription:</b> @Model.Medicines</p>
            }
            @if (file_service.GetNamesOfFiles(Model.Id).Count != 0)
            {
            <p>
                <b>Additional files:</b> @foreach (var file in file_service.GetNamesOfFiles(Model.Id))
                {
                    using (Html.BeginForm("Download", "Consults", new { consultId = Model.Id, fileName = @file }, FormMethod.Post, null, new { }))
                    {
                        <button class="button_download">@file</button>
                    }
                    <br />
                }
            </p>
            }
    </div>
    <div id="Options">
        @if (User.IsInRole("Owner") || User.IsInRole("Moderator"))
        {
            <a asp-action="Edit" asp-route-id="@Model.Id">Edit</a>
            <a asp-action="Delete" asp-route-id="@Model.Id"> | Delete | </a>
            <a asp-area="" asp-controller="Consults" asp-action="ConsultsPaginated">Back to List</a>
        }
        @if (User.IsInRole("Medic"))
        {
            <a asp-area="" asp-controller="Consults" asp-action="MyConsultsPaginated" asp-route-id="@UserManager.GetUserId(User)" asp-route-NoPage="1">Back to List</a>
        }
        @if (User.IsInRole("Pacient"))
        {
            <a asp-area="" asp-controller="Consults" asp-action="MyResultsPaginated" asp-route-id="@UserManager.GetUserId(User)" asp-route-NoPage="1">Back to List</a>
        }
                
    </div>
</div>

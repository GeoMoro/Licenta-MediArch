@model Data.Domain.Entities.Consult

@using MediArch.Services.Interfaces
@inject IApplicationUserService user_service

@using Data.Domain.Interfaces.ServiceInterfaces
@inject IConsultService consult_service

@{
    ViewData["Title"] = "Consult - Delete";
}
<div class="General_remake">
    <br />
    <h2>@ViewData["Title"]</h2>
    <h3>Are you sure you want to delete this consult?</h3>

    <div>

        <div>
            <div>
                <p><b>Medic:</b> <a asp-action="Details" asp-controller="ApplicationUsers" asp-route-id="@Model.MedicId">@user_service.GetFullNameById(Model.MedicId.ToString()).ToString()</a></p>
                <p><b>Pacient:</b> <a asp-action="Details" asp-controller="ApplicationUsers" asp-route-id="@Model.PacientId">@user_service.GetFullNameById(Model.PacientId.ToString()).ToString()</a></p>
                <p><b>ConsultDate:</b> Model.ConsultDate</p>
                <p><b>Medicines:</b> Model.Medicines</p>
                <p><b>ConsultResult:</b> Model.ConsultResult</p>
                <p>
                    <b>Additional files:</b> @foreach (var file in consult_service.GetNamesOfFiles(Model.Id))
                    {  <br>
                        <input type="button" id="deletefile_@file" value="@file" class="button_download" />
                    }
                    <br>
                    <br>
                    <h4 class="Note_Red">Note: Click on any file to delete it!</h4>
                </p>

            </div>
        </div>

        @if (User.IsInRole("Owner") || User.IsInRole("Moderator"))
        {
            <div class="Centered">
                <form asp-action="Delete">
                    <input type="hidden" asp-for="Id" />
                    <input type="submit" value="Delete" class="btn btn-default" /> |
                    <a asp-area="" asp-controller="Consults" asp-action="ConsultsPaginated">Back to List</a>
                </form>
            </div>
        }
    </div>
</div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script type="text/javascript">

    $(document).ready(function () {

        $('[id*=deletefile_]').click(function () {

            var cnsId = $('[id=Id]').val();
            var fName = this.id.substring(11);
            var link = window.location.href;


            $.ajax({
                type: 'DELETE',
                url: '/Consults/DeleteFile',//'@Url.Action("DeleteFile", "Consults")',//
                data: { fileName: fName, consultId: cnsId},
                success: function () {
                    console.log(cnsId);
                    console.log(fName);
                }
            }).done(function (data) {
                console.log("done")
                console.log(link)
                location.replace(link);
            });
        });
    });
    </script>
